<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste - Informa√ß√µes do Usu√°rio</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <style>
        body { 
            padding: 40px;
            background-color: #f8f9fa;
        }
        .test-card {
            background: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .status-ok { color: #28a745; }
        .status-error { color: #dc3545; }
        .code-block {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid #007bff;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="mb-4">üîß Teste de Informa√ß√µes do Usu√°rio</h1>
        
        <div class="test-card">
            <h3>1. Status do API Client</h3>
            <div id="api-status"></div>
        </div>

        <div class="test-card">
            <h3>2. Informa√ß√µes do Usu√°rio Logado</h3>
            <div id="user-info"></div>
            <button class="btn btn-primary mt-3" onclick="loadUserInfo()">Recarregar Informa√ß√µes</button>
        </div>

        <div class="test-card">
            <h3>3. Simula√ß√£o do Topbar</h3>
            <div class="d-flex align-items-center gap-3 p-3 bg-light rounded">
                <img id="test-topbar-avatar" src="assets/images/users/user-3.jpg" width="40" class="rounded-circle" alt="avatar">
                <div>
                    <div class="fw-bold" id="test-topbar-name">Carregando...</div>
                    <small class="text-muted" id="test-topbar-role">Carregando...</small>
                </div>
            </div>
        </div>

        <div class="test-card">
            <h3>4. Simula√ß√£o do Sidenav</h3>
            <div class="d-flex align-items-center gap-3 p-3 bg-light rounded">
                <img id="test-sidenav-avatar" src="assets/images/users/user-3.jpg" width="50" class="rounded-circle" alt="avatar">
                <div>
                    <div class="fw-bold" id="test-sidenav-name">Carregando...</div>
                    <small class="text-muted" id="test-sidenav-role">Carregando...</small>
                </div>
            </div>
        </div>

        <div class="test-card">
            <h3>5. Teste de Logout</h3>
            <button class="btn btn-danger" onclick="testLogout()">Testar Logout</button>
        </div>
    </div>

    <!-- Incluir API Client -->
    <script src="assets/js/api-client.js"></script>

    <script>
        function checkAPIStatus() {
            const statusDiv = document.getElementById('api-status');
            
            if (typeof window.eventosAPI !== 'undefined') {
                const isLoggedIn = window.eventosAPI.isLoggedIn();
                const token = window.eventosAPI.getToken();
                
                statusDiv.innerHTML = `
                    <div class="status-ok">‚úÖ API Client carregado com sucesso</div>
                    <div class="code-block">
                        <strong>Status:</strong> ${isLoggedIn ? 'Logado' : 'N√£o logado'}<br>
                        <strong>Token presente:</strong> ${token ? 'Sim' : 'N√£o'}<br>
                        <strong>Token preview:</strong> ${token ? token.substring(0, 50) + '...' : 'N/A'}
                    </div>
                `;
            } else {
                statusDiv.innerHTML = `
                    <div class="status-error">‚ùå API Client n√£o encontrado</div>
                    <div class="code-block">
                        Verifique se o arquivo assets/js/api-client.js est√° sendo carregado corretamente.
                    </div>
                `;
            }
        }

        function loadUserInfo() {
            try {
                const currentUser = window.eventosAPI?.getCurrentUser();
                const userInfoDiv = document.getElementById('user-info');
                
                if (currentUser) {
                    userInfoDiv.innerHTML = `
                        <div class="status-ok">‚úÖ Usu√°rio encontrado</div>
                        <div class="code-block">
                            <strong>ID:</strong> ${currentUser.id}<br>
                            <strong>Nome:</strong> ${currentUser.name}<br>
                            <strong>Email:</strong> ${currentUser.email}<br>
                            <strong>Role:</strong> ${currentUser.role}<br>
                            <strong>Company ID:</strong> ${currentUser.company_id || 'N/A'}<br>
                            <strong>Avatar:</strong> ${currentUser.avatar || 'N/A'}
                        </div>
                    `;
                    
                    // Atualizar simula√ß√µes
                    updateTestElements(currentUser);
                } else {
                    userInfoDiv.innerHTML = `
                        <div class="status-error">‚ùå Nenhum usu√°rio logado encontrado</div>
                        <div class="code-block">
                            Fa√ßa login primeiro em <a href="auth-sign-in.php">auth-sign-in.php</a>
                        </div>
                    `;
                }
            } catch (error) {
                document.getElementById('user-info').innerHTML = `
                    <div class="status-error">‚ùå Erro ao carregar informa√ß√µes do usu√°rio</div>
                    <div class="code-block">Erro: ${error.message}</div>
                `;
            }
        }

        function updateTestElements(user) {
            const roleLabels = {
                'master': 'Administrador Master',
                'client_admin': 'Administrador',
                'client_organizer': 'Organizador',
                'participant': 'Participante'
            };

            // Atualizar simula√ß√£o do topbar
            document.getElementById('test-topbar-name').textContent = user.name || 'Usu√°rio';
            document.getElementById('test-topbar-role').textContent = roleLabels[user.role] || user.role;
            
            // Atualizar simula√ß√£o do sidenav
            document.getElementById('test-sidenav-name').textContent = user.name || 'Usu√°rio';
            document.getElementById('test-sidenav-role').textContent = roleLabels[user.role] || user.role;

            // Atualizar avatares se dispon√≠vel
            if (user.avatar) {
                document.getElementById('test-topbar-avatar').src = user.avatar;
                document.getElementById('test-sidenav-avatar').src = user.avatar;
            }
        }

        async function testLogout() {
            try {
                const result = await Swal.fire({
                    title: 'Teste de Logout',
                    text: 'Isso ir√° limpar seus dados de login. Continuar?',
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#d33',
                    cancelButtonColor: '#3085d6',
                    confirmButtonText: 'Sim, testar',
                    cancelButtonText: 'Cancelar'
                });

                if (result.isConfirmed) {
                    if (window.eventosAPI) {
                        window.eventosAPI.logout();
                    }
                    
                    await Swal.fire({
                        title: 'Logout realizado!',
                        text: 'Dados limpos com sucesso.',
                        icon: 'success',
                        timer: 2000,
                        showConfirmButton: false
                    });
                    
                    // Recarregar informa√ß√µes
                    checkAPIStatus();
                    loadUserInfo();
                }
            } catch (error) {
                console.error('Erro no teste de logout:', error);
                Swal.fire('Erro', 'Erro no teste de logout', 'error');
            }
        }

        // Carregar informa√ß√µes quando a p√°gina carregar
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                checkAPIStatus();
                loadUserInfo();
            }, 100);
        });
    </script>
</body>
</html>